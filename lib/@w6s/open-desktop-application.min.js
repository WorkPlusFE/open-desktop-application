/*!
 * @w6s/open-desktop-application.js v1.1.0
 * (c) 2019 WorkPlusFE
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).openDesktopApplication=n()}(this,function(){"use strict";function f(e,n,t){return e.addEventListener?(e.addEventListener(n,t),{remove:function(){e.removeEventListener(n,t)}}):(e.attachEvent(n,t),{remove:function(){e.detachEvent(n,t)}})}function d(e,n){var t=document.createElement("iframe");return t.src=n,t.id="hiddenIframe",t.style.display="none",e.appendChild(t),t}function l(e,n,t){var o=setTimeout(function(){n(),i.remove()},1e3),r=document.querySelector("#hiddenIframe");r=r||d(document.body,"about:blank");var i=f(window,"blur",function(){clearTimeout(o),i.remove(),t()});r.contentWindow.location.href=e}function s(e,n,t){var o,r,i,a;10===c()?function(e,n,t){var o=setTimeout(n,1e3);window.addEventListener("blur",function(){clearTimeout(o),t()});var r=document.querySelector("#hiddenIframe");r=r||d(document.body,"about:blank");try{r.contentWindow.location.href=e}catch(e){n(),clearTimeout(o)}}(e,n,t):9===c()||11===c()?l(e,n,t):(o=e,r=n,i=t,(a=window.open("","","width=0,height=0")).document.write("<iframe src='"+o+"'></iframe>"),setTimeout(function(){try{a.setTimeout("window.close()",1e3),i()}catch(e){a.close(),r()}},1e3))}function c(){var e=-1;if("Microsoft Internet Explorer"===navigator.appName){var n=navigator.userAgent;null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(n)&&(e=parseFloat(RegExp.$1))}else if("Netscape"===navigator.appName){n=navigator.userAgent;null!=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/.exec(n)&&(e=parseFloat(RegExp.$1))}return e}function u(e,n,t,o){function r(){n&&n()}function i(){t&&t()}if(navigator.msLaunchUri)navigator.msLaunchUri(e,t,n);else{var a=(c=!!window.opera||!!~navigator.userAgent.indexOf(" OPR/"),u=navigator.userAgent.toLowerCase(),{isOpera:c,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:~u.indexOf("safari")&&!~u.indexOf("chrome")||0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),isIOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,isChrome:!!window.chrome&&!c,isIE:!!document.documentMode});a.isFirefox?function(e,n,t){var o=document.querySelector("#hiddenIframe");o=o||d(document.body,"about:blank");try{o.contentWindow.location.href=e,t()}catch(e){"NS_ERROR_UNKNOWN_PROTOCOL"==e.name&&n()}}(e,r,i):a.isChrome||a.isIOS?function(e,n,t){for(var o=setTimeout(function(){n(),i.remove()},1e3),r=window;r!=r.parent;)r=r.parent;var i=f(r,"blur",function(){clearTimeout(o),i.remove(),t()});window.location=e}(e,r,i):a.isIE?s(e,r,i):a.isSafari?l(e,r,i):o()}var c,u}var v=function(e,n,t,o,r,i,a,c){if(!e){var u;if(void 0===n)u=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[t,o,r,i,a,c],d=0;(u=Error(n.replace(/%s/g,function(){return f[d++]}))).name="Invariant Violation"}throw u.framesToPop=1,u}},t=Object.prototype.toString,o=Array.isArray;var m=function(e){return"string"==typeof e||!o(e)&&(!!(n=e)&&"object"==typeof n)&&"[object String]"==t.call(e);var n},e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n="[object Null]",r="[object Undefined]",i="object"==typeof self&&self&&self.Object===Object&&self,a="object"==typeof e&&e&&e.Object===Object&&e||i||Function("return this")(),p=Object.prototype,b=p.hasOwnProperty,y=p.toString,g=a.Symbol,h=g?g.toStringTag:void 0;function w(e){return null==e?void 0===e?r:n:h&&h in Object(e)?function(e){var n=b.call(e,h),t=e[h];try{var o=!(e[h]=void 0)}catch(e){}var r=y.call(e);o&&(n?e[h]=t:delete e[h]);return r}(e):y.call(e)}var j=function(e){if(t=typeof(n=e),null==n||"object"!=t&&"function"!=t)return!1;var n,t,o=w(e);return"[object Function]"==o||"[object GeneratorFunction]"==o||"[object AsyncFunction]"==o||"[object Proxy]"==o};var O=function(e){var n=typeof e;return!!e&&("object"==n||"function"==n)};
/**
     * open-desktop-application
     *
     * @param object { protocol, action, query, fail, success }
     * 
     * protocol: string (eg, workplus)
     * action: string (eg, joinchat)
     * query: object (eg, { id: 1, name: 'test' })
     * fail: function
     * success: function
     *  
     * return => workplus://joinchat/?id=1&name=test
     */return function(e){try{var n=e.protocol,t=e.action,o=e.query,r=e.fail,i=e.success;v(m(n),"[protocol] Must be a non-empty string"),v(m(t),"[action] Must be a non-empty string");var a="".concat(n,"://").concat(t);O(o)&&(a+="?".concat(function(e){var t=0<arguments.length&&void 0!==e?e:{};return Object.keys(t).sort().map(function(e){var n=t[e];return null==n&&(n=""),e+"="+n}).join("&")}(o))),u(a,function(e){j(r)&&r(e)},function(){j(i)&&i()},function(){j(r)&&r({supported:!1})})}catch(e){j(fail)&&fail(e),console.log(e)}}});
